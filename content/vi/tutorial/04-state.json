{"meta":{"title":"State","prev":"/tutorial/03-components","next":"/tutorial/05-refs","solvable":true,"tutorial":{"setup":"useResult(function () {\n  var options = require('preact').options;\n\n  var oe = options.event;\n  options.event = function(e) {\n    if (oe) oe.apply(this, arguments);\n\n    if (e.currentTarget.localName !== 'button') return;\n    var root = e.currentTarget.parentNode.parentNode;\n    var text = root.innerText.match(/Count:\\s*([\\w.-]*)/i);\n    if (!text) return;\n    if (!text[1].match(/^-?\\d+$/)) {\n      return console.warn('Gợi ý: có vẻ bạn chưa render {count} ở đâu đó.');\n    }\n    setTimeout(function() {\n      var text2 = root.innerText.match(/Count:\\s*([\\w.-]*)/i);\n      if (!text2) {\n        return console.warn('Gợi ý: bạn có nhớ render {count} không?');\n      }\n      if (text2[1] == text[1]) {\n        return console.warn('Gợi ý: hãy nhớ gọi hàm \"setter\" để thay đổi giá trị của `count`.');\n      }\n      if (!text2[1].match(/^-?\\d+$/)) {\n        return console.warn('Gợi ý: có vẻ như `count` đang được gán thành một giá trị không phải số.');\n      }\n\n      if (Number(text2[1]) === Number(text[1]) + 1) {\n        solutionCtx.setSolved(true);\n      }\n    }, 10);\n  }\n\n  return function () {\n    options.event = oe;\n  };\n}, []);","initial":"import { render } from 'preact';\nimport { useState } from 'preact/hooks';\n\nfunction MyButton(props) {\n  return <button style={props.style} onClick={props.onClick}>{props.children}</button>\n}\n\nfunction App() {\n  const clicked = () => {\n    // tăng count lên 1 tại đây\n  }\n\n  return (\n    <div>\n      <p class=\"count\">Số đếm:</p>\n      <MyButton style={{ color: 'purple' }} onClick={clicked}>Nhấn tôi</MyButton>\n    </div>\n  )\n}\n\nrender(<App />, document.getElementById(\"app\"));","final":"import { render } from 'preact';\nimport { useState } from 'preact/hooks';\n\nfunction MyButton(props) {\n  return <button style={props.style} onClick={props.onClick}>{props.children}</button>\n}\n\nfunction App() {\n  const [count, setCount] = useState(0)\n\n  const clicked = () => {\n    setCount(count + 1)\n  }\n\n  return (\n    <div>\n      <p class=\"count\">Số đếm: {count}</p>\n      <MyButton style={{ color: 'purple' }} onClick={clicked}>Nhấn tôi</MyButton>\n    </div>\n  )\n}\n\nrender(<App />, document.getElementById(\"app\"));"}},"html":"<h1>State (Trạng thái)</h1><p>Bây giờ chúng ta đã biết cách tạo các phần tử HTML và thành phần, cũng như cách truyền props và các hàm xử lý sự kiện cho cả hai bằng JSX, đã đến lúc tìm hiểu cách cập nhật cây Virtual DOM.</p>\n<p>Như đã đề cập ở chương trước, cả thành phần hàm và thành phần lớp đều có thể có <strong>state</strong> (trạng thái) – dữ liệu được lưu trữ bởi một thành phần và được sử dụng để thay đổi cây Virtual DOM của nó. Khi một thành phần cập nhật state của nó, Preact sẽ render lại thành phần đó với giá trị state mới. Đối với thành phần hàm, điều này có nghĩa là Preact sẽ gọi lại hàm đó, còn với thành phần lớp thì chỉ gọi lại phương thức <code>render()</code> của lớp đó. Hãy cùng xem ví dụ cho từng loại.</p>\n\n\t\t\t\t<h2 id=\"state-trong-thành-phần-lớp\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#state-trong-thành-phần-lớp\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: State trong thành phần lớp (#state-trong-thành-phần-lớp)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>State trong thành phần lớp</span>\n\t\t\t\t</h2><p>Thành phần lớp có một thuộc tính <code>state</code>, là một đối tượng chứa dữ liệu mà thành phần có thể sử dụng khi phương thức <code>render()</code> của nó được gọi. Một thành phần có thể gọi <code>this.setState()</code> để cập nhật thuộc tính <code>state</code> của nó và yêu cầu Preact render lại thành phần đó.</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyButton</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">clicked</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">clicked</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>clicked <span class=\"token operator\">?</span> <span class=\"token string\">'Đã nhấn'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'Chưa nhấn lần nào'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Khi nhấn nút sẽ gọi <code>this.setState()</code>, điều này khiến Preact gọi lại phương thức <code>render()</code> của lớp. Khi đó, <code>this.state.clicked</code> đã là <code>true</code>, nên phương thức <code>render()</code> trả về một cây Virtual DOM chứa văn bản &quot;Đã nhấn&quot; thay vì &quot;Chưa nhấn lần nào&quot;, khiến Preact cập nhật nội dung nút trên DOM.</p>\n\n\t\t\t\t<h2 id=\"state-trong-thành-phần-hàm-với-hooks\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#state-trong-thành-phần-hàm-với-hooks\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: State trong thành phần hàm với hooks (#state-trong-thành-phần-hàm-với-hooks)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>State trong thành phần hàm với hooks</span>\n\t\t\t\t</h2><p>Thành phần hàm cũng có thể có state! Dù chúng không có thuộc tính <code>this.state</code> như thành phần lớp, một module nhỏ đi kèm với Preact cung cấp các hàm để lưu trữ và làm việc với state bên trong thành phần hàm, gọi là &quot;hooks&quot;.</p>\n<p>Hooks là các hàm đặc biệt có thể được gọi bên trong một thành phần hàm. Chúng đặc biệt vì chúng <strong>ghi nhớ thông tin qua các lần render</strong>, giống như thuộc tính và phương thức trên một class. Ví dụ, hook <code>useState</code> trả về một mảng gồm một giá trị và một hàm &quot;setter&quot; có thể được gọi để cập nhật giá trị đó. Khi một thành phần được gọi lại (render lại) nhiều lần, mọi lần gọi <code>useState()</code> sẽ trả về đúng cùng một mảng như trước.</p>\n<blockquote>\n<p>ℹ️ <strong><em>Hooks hoạt động như thế nào?</em></strong></p>\n<p>Ở phía bên trong, các hàm hook như <code>setState</code> hoạt động bằng cách lưu trữ dữ liệu trong một chuỗi các &quot;slot&quot; gắn với mỗi thành phần trong cây Virtual DOM. Mỗi lần gọi một hook sẽ sử dụng một slot, và tăng một bộ đếm &quot;slot number&quot; nội bộ để lần gọi tiếp theo dùng slot tiếp theo. Preact sẽ đặt lại bộ đếm này trước khi gọi mỗi thành phần, nên mỗi lần gọi hook sẽ gắn với cùng một slot khi thành phần được render nhiều lần.</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> setName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bob\"</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// slot 0</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>age<span class=\"token punctuation\">,</span> setAge<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>         <span class=\"token comment\">// slot 1</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>online<span class=\"token punctuation\">,</span> setOnline<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// slot 2</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Điều này gọi là &quot;call site ordering&quot;, và đó là lý do tại sao các hook luôn phải được gọi theo cùng một thứ tự trong một thành phần, và không được gọi có điều kiện hoặc trong vòng lặp.</p>\n</blockquote>\n<p>Hãy xem ví dụ về hook <code>useState</code>:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">MyButton</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>clicked<span class=\"token punctuation\">,</span> setClicked<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setClicked</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleClick<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>clicked <span class=\"token operator\">?</span> <span class=\"token string\">'Đã nhấn'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'Chưa nhấn lần nào'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Khi nhấn nút sẽ gọi <code>setClicked(true)</code>, cập nhật trường state được tạo bởi <code>useState()</code>, điều này khiến Preact render lại thành phần này. Khi thành phần được render (gọi) lần thứ hai, giá trị của biến state <code>clicked</code> sẽ là <code>true</code>, và Virtual DOM trả về sẽ có văn bản &quot;Đã nhấn&quot; thay vì &quot;Chưa nhấn lần nào&quot;. Điều này khiến Preact cập nhật nội dung nút trên DOM.</p>\n<hr>\n\n\t\t\t\t<h2 id=\"thực-hành\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#thực-hành\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Thực hành! (#thực-hành)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Thực hành!</span>\n\t\t\t\t</h2><p>Hãy thử tạo một bộ đếm, bắt đầu từ mã chúng ta đã viết ở chương trước. Chúng ta sẽ cần lưu trữ một số <code>count</code> trong state, và tăng giá trị của nó lên <code>1</code> mỗi khi nhấn nút.</p>\n<p>Vì chúng ta đã dùng thành phần hàm ở chương trước, nên có thể dễ dàng dùng hooks, nhưng bạn có thể chọn bất kỳ cách lưu trữ state nào bạn thích.</p>\n<solution>\n  <h4>🎉 Chúc mừng!</h4>\n  <p>Bạn đã học cách sử dụng state!</p>\n</solution>\n\n\n\n\n\n\n\n"}