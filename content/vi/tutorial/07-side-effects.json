{"meta":{"title":"TÃ¡c Ä‘á»™ng phá»¥ (Side Effects)","prev":"/tutorial/06-context","next":"/tutorial/08-keys","solvable":true,"tutorial":{"setup":"useRealm(function (realm) {\n  var win = realm.globalThis;\n  var prevConsoleLog = win.console.log;\n  win.console.log = function(m, s) {\n    if (/Count is now/.test(m) && s === 1) {\n      solutionCtx.setSolved(true);\n    }\n    return prevConsoleLog.apply(win.console, arguments);\n  };\n\n  return function () {\n    win.console.log = prevConsoleLog;\n  };\n}, []);","initial":"import { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    console.log('Count is now: ', count)\n  }, []);\n  // ^^ báº¯t Ä‘áº§u tá»« Ä‘Ã¢y!\n\n  return <button onClick={() => setCount(count+1)}>{count}</button>\n}\n\nrender(<App />, document.getElementById(\"app\"));","final":"import { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    console.log('Count is now: ', count)\n  }, [count]);\n  // ^^ báº¯t Ä‘áº§u tá»« Ä‘Ã¢y!\n\n  return <button onClick={() => setCount(count+1)}>{count}</button>\n}\n\nrender(<App />, document.getElementById(\"app\"));"}},"html":"<h1>TÃ¡c Ä‘á»™ng phá»¥ (Side Effects)</h1><p>TÃ¡c Ä‘á»™ng phá»¥ lÃ  nhá»¯ng Ä‘oáº¡n mÃ£ Ä‘Æ°á»£c cháº¡y khi cÃ³ sá»± thay Ä‘á»•i trong cÃ¢y Virtual DOM. ChÃºng khÃ´ng tuÃ¢n theo cÃ¡ch tiáº¿p cáº­n tiÃªu chuáº©n lÃ  nháº­n <code>props</code> vÃ  tráº£ vá» má»™t cÃ¢y Virtual DOM má»›i, vÃ  thÆ°á»ng &quot;vÆ°Æ¡n ra ngoÃ i&quot; cÃ¢y Ä‘á»ƒ thay Ä‘á»•i tráº¡ng thÃ¡i hoáº·c gá»i mÃ£ kiá»ƒu má»‡nh lá»‡nh, nhÆ° gá»i cÃ¡c API cá»§a DOM. TÃ¡c Ä‘á»™ng phá»¥ cÅ©ng thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ kÃ­ch hoáº¡t viá»‡c láº¥y dá»¯ liá»‡u.</p>\n\n\t\t\t\t<h2 id=\"effects:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-hÃ m\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#effects:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-hÃ m\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Effects: tÃ¡c Ä‘á»™ng phá»¥ trong thÃ nh pháº§n hÃ m (#effects:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-hÃ m)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Effects: tÃ¡c Ä‘á»™ng phá»¥ trong thÃ nh pháº§n hÃ m</span>\n\t\t\t\t</h2><p>ChÃºng ta Ä‘Ã£ tá»«ng tháº¥y má»™t vÃ­ dá»¥ vá» tÃ¡c Ä‘á»™ng phá»¥ trong má»™t chÆ°Æ¡ng trÆ°á»›c, khi há»c vá» refs vÃ  hook <code>useRef()</code>. Khi ref cá»§a chÃºng ta Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n thuá»™c tÃ­nh <code>current</code> trá» Ä‘áº¿n má»™t pháº§n tá»­ DOM, chÃºng ta cáº§n má»™t cÃ¡ch Ä‘á»ƒ &quot;kÃ­ch hoáº¡t&quot; mÃ£ sáº½ tÆ°Æ¡ng tÃ¡c vá»›i pháº§n tá»­ Ä‘Ã³.</p>\n<p>Äá»ƒ kÃ­ch hoáº¡t mÃ£ sau khi render, chÃºng ta dÃ¹ng hook <code>useEffect()</code>, Ä‘Ã¢y lÃ  cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ táº¡o tÃ¡c Ä‘á»™ng phá»¥ tá»« má»™t thÃ nh pháº§n hÃ m:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRef<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// hÃ m callback nÃ y sáº½ cháº¡y sau khi &lt;App> Ä‘Æ°á»£c render:</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// truy cáº­p pháº§n tá»­ DOM liÃªn káº¿t:</span>\n    input<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>input<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>LÆ°u Ã½ máº£ng rá»—ng Ä‘Æ°á»£c truyá»n lÃ m Ä‘á»‘i sá»‘ thá»© hai cho <code>useEffect()</code>. CÃ¡c hÃ m callback effect sáº½ cháº¡y khi báº¥t ká»³ giÃ¡ trá»‹ nÃ o trong máº£ng &quot;phá»¥ thuá»™c&quot; Ä‘Ã³ thay Ä‘á»•i giá»¯a cÃ¡c láº§n render. VÃ­ dá»¥, láº§n Ä‘áº§u tiÃªn má»™t thÃ nh pháº§n Ä‘Æ°á»£c render, táº¥t cáº£ cÃ¡c callback effect sáº½ cháº¡y vÃ¬ khÃ´ng cÃ³ giÃ¡ trá»‹ &quot;phá»¥ thuá»™c&quot; trÆ°á»›c Ä‘Ã³ Ä‘á»ƒ so sÃ¡nh.</p>\n<p>ChÃºng ta cÃ³ thá»ƒ thÃªm giÃ¡ trá»‹ vÃ o máº£ng &quot;phá»¥ thuá»™c&quot; Ä‘á»ƒ kÃ­ch hoáº¡t callback effect dá»±a trÃªn Ä‘iá»u kiá»‡n, thay vÃ¬ chá»‰ khi thÃ nh pháº§n Ä‘Æ°á»£c render láº§n Ä‘áº§u. Äiá»u nÃ y thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ cháº¡y mÃ£ khi dá»¯ liá»‡u thay Ä‘á»•i, hoáº·c khi má»™t thÃ nh pháº§n bá»‹ loáº¡i khá»i trang (&quot;unmounted&quot;).</p>\n<p>HÃ£y xem má»™t vÃ­ dá»¥:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;App> vá»«a Ä‘Æ°á»£c render láº§n Ä‘áº§u'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'giÃ¡ trá»‹ count Ä‘Ã£ thay Ä‘á»•i thÃ nh: '</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">//  ^ cháº¡y Ä‘oáº¡n nÃ y má»—i khi `count` thay Ä‘á»•i, vÃ  cáº£ láº§n render Ä‘áº§u tiÃªn</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<h2 id=\"phÆ°Æ¡ng-thá»©c-vÃ²ng-Ä‘á»i:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-lá»›p\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#phÆ°Æ¡ng-thá»©c-vÃ²ng-Ä‘á»i:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-lá»›p\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: PhÆ°Æ¡ng thá»©c vÃ²ng Ä‘á»i: tÃ¡c Ä‘á»™ng phá»¥ trong thÃ nh pháº§n lá»›p (#phÆ°Æ¡ng-thá»©c-vÃ²ng-Ä‘á»i:-tÃ¡c-Ä‘á»™ng-phá»¥-trong-thÃ nh-pháº§n-lá»›p)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>PhÆ°Æ¡ng thá»©c vÃ²ng Ä‘á»i: tÃ¡c Ä‘á»™ng phá»¥ trong thÃ nh pháº§n lá»›p</span>\n\t\t\t\t</h2><p>ThÃ nh pháº§n lá»›p cÅ©ng cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c tÃ¡c Ä‘á»™ng phá»¥, báº±ng cÃ¡ch triá»ƒn khai báº¥t ká»³ <a href=\"/guide/v10/components#lifecycle-methods\">phÆ°Æ¡ng thá»©c vÃ²ng Ä‘á»i</a> nÃ o mÃ  Preact cung cáº¥p. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ phÆ°Æ¡ng thá»©c vÃ²ng Ä‘á»i thÆ°á»ng dÃ¹ng nháº¥t:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">PhÆ°Æ¡ng thá»©c vÃ²ng Ä‘á»i</th>\n<th align=\"left\">Khi nÃ o nÃ³ cháº¡y:</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>componentWillMount</code></td>\n<td align=\"left\">ngay trÆ°á»›c khi má»™t component Ä‘Æ°á»£c render láº§n Ä‘áº§u</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentDidMount</code></td>\n<td align=\"left\">sau khi má»™t component Ä‘Æ°á»£c render láº§n Ä‘áº§u</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentWillReceiveProps</code></td>\n<td align=\"left\">trÆ°á»›c khi má»™t component Ä‘Æ°á»£c render láº¡i</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentDidUpdate</code></td>\n<td align=\"left\">sau khi má»™t component Ä‘Æ°á»£c render láº¡i</td>\n</tr>\n</tbody></table>\n<p>Má»™t trong nhá»¯ng vÃ­ dá»¥ phá»• biáº¿n nháº¥t vá» viá»‡c sá»­ dá»¥ng tÃ¡c Ä‘á»™ng phá»¥ trong thÃ nh pháº§n lá»›p lÃ  láº¥y dá»¯ liá»‡u khi má»™t component Ä‘Æ°á»£c render láº§n Ä‘áº§u, sau Ä‘Ã³ lÆ°u dá»¯ liá»‡u Ä‘Ã³ vÃ o state. VÃ­ dá»¥ sau Ä‘Ã¢y cho tháº¥y má»™t component yÃªu cáº§u thÃ´ng tin ngÆ°á»i dÃ¹ng tá»« má»™t API JSON sau láº§n render Ä‘áº§u tiÃªn, rá»“i hiá»ƒn thá»‹ thÃ´ng tin Ä‘Ã³.</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// hÃ m nÃ y Ä‘Æ°á»£c gá»i sau khi component Ä‘Æ°á»£c render láº§n Ä‘áº§u:</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// láº¥y thÃ´ng tin user JSON, lÆ°u vÃ o `state.user`:</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/user'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// náº¿u chÆ°a nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u, hiá»ƒn thá»‹ thÃ´ng bÃ¡o Ä‘ang táº£i:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Äang táº£i...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">// Ä‘Ã£ cÃ³ dá»¯ liá»‡u! hiá»ƒn thá»‹ tÃªn ngÆ°á»i dÃ¹ng láº¥y vá» tá»« API:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Xin chÃ o, </span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">}</span><span class=\"token plain-text\">!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<h2 id=\"thá»±c-hÃ nh\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#thá»±c-hÃ nh\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Thá»±c hÃ nh! (#thá»±c-hÃ nh)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Thá»±c hÃ nh!</span>\n\t\t\t\t</h2><p>ChÃºng ta sáº½ giá»¯ bÃ i táº­p nÃ y Ä‘Æ¡n giáº£n: hÃ£y thay Ä‘á»•i Ä‘oáº¡n mÃ£ máº«u bÃªn pháº£i Ä‘á»ƒ log ra má»—i khi <code>count</code> thay Ä‘á»•i, thay vÃ¬ chá»‰ khi <code>&lt;App&gt;</code> Ä‘Æ°á»£c render láº§n Ä‘áº§u.</p>\n<solution>\n  <h4>ğŸ‰ ChÃºc má»«ng!</h4>\n  <p>Báº¡n Ä‘Ã£ há»c cÃ¡ch sá»­ dá»¥ng tÃ¡c Ä‘á»™ng phá»¥ trong Preact.</p>\n</solution>\n\n\n\n\n\n\n\n"}