{"meta":{"title":"Tác động phụ (Side Effects)","prev":"/tutorial/06-context","next":"/tutorial/08-keys","solvable":true,"tutorial":{"setup":"useRealm(function (realm) {\n  var win = realm.globalThis;\n  var prevConsoleLog = win.console.log;\n  win.console.log = function(m, s) {\n    if (/Count is now/.test(m) && s === 1) {\n      solutionCtx.setSolved(true);\n    }\n    return prevConsoleLog.apply(win.console, arguments);\n  };\n\n  return function () {\n    win.console.log = prevConsoleLog;\n  };\n}, []);","initial":"import { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    console.log('Count is now: ', count)\n  }, []);\n  // ^^ bắt đầu từ đây!\n\n  return <button onClick={() => setCount(count+1)}>{count}</button>\n}\n\nrender(<App />, document.getElementById(\"app\"));","final":"import { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    console.log('Count is now: ', count)\n  }, [count]);\n  // ^^ bắt đầu từ đây!\n\n  return <button onClick={() => setCount(count+1)}>{count}</button>\n}\n\nrender(<App />, document.getElementById(\"app\"));"}},"html":"<h1>Tác động phụ (Side Effects)</h1><p>Tác động phụ là những đoạn mã được chạy khi có sự thay đổi trong cây Virtual DOM. Chúng không tuân theo cách tiếp cận tiêu chuẩn là nhận <code>props</code> và trả về một cây Virtual DOM mới, và thường &quot;vươn ra ngoài&quot; cây để thay đổi trạng thái hoặc gọi mã kiểu mệnh lệnh, như gọi các API của DOM. Tác động phụ cũng thường được dùng để kích hoạt việc lấy dữ liệu.</p>\n\n\t\t\t\t<h2 id=\"effects:-tác-động-phụ-trong-thành-phần-hàm\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#effects:-tác-động-phụ-trong-thành-phần-hàm\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Effects: tác động phụ trong thành phần hàm (#effects:-tác-động-phụ-trong-thành-phần-hàm)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Effects: tác động phụ trong thành phần hàm</span>\n\t\t\t\t</h2><p>Chúng ta đã từng thấy một ví dụ về tác động phụ trong một chương trước, khi học về refs và hook <code>useRef()</code>. Khi ref của chúng ta đã được gán thuộc tính <code>current</code> trỏ đến một phần tử DOM, chúng ta cần một cách để &quot;kích hoạt&quot; mã sẽ tương tác với phần tử đó.</p>\n<p>Để kích hoạt mã sau khi render, chúng ta dùng hook <code>useEffect()</code>, đây là cách phổ biến nhất để tạo tác động phụ từ một thành phần hàm:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRef<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// hàm callback này sẽ chạy sau khi &lt;App> được render:</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// truy cập phần tử DOM liên kết:</span>\n    input<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>input<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Lưu ý mảng rỗng được truyền làm đối số thứ hai cho <code>useEffect()</code>. Các hàm callback effect sẽ chạy khi bất kỳ giá trị nào trong mảng &quot;phụ thuộc&quot; đó thay đổi giữa các lần render. Ví dụ, lần đầu tiên một thành phần được render, tất cả các callback effect sẽ chạy vì không có giá trị &quot;phụ thuộc&quot; trước đó để so sánh.</p>\n<p>Chúng ta có thể thêm giá trị vào mảng &quot;phụ thuộc&quot; để kích hoạt callback effect dựa trên điều kiện, thay vì chỉ khi thành phần được render lần đầu. Điều này thường được dùng để chạy mã khi dữ liệu thay đổi, hoặc khi một thành phần bị loại khỏi trang (&quot;unmounted&quot;).</p>\n<p>Hãy xem một ví dụ:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;App> vừa được render lần đầu'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'giá trị count đã thay đổi thành: '</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">//  ^ chạy đoạn này mỗi khi `count` thay đổi, và cả lần render đầu tiên</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<h2 id=\"phương-thức-vòng-đời:-tác-động-phụ-trong-thành-phần-lớp\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#phương-thức-vòng-đời:-tác-động-phụ-trong-thành-phần-lớp\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Phương thức vòng đời: tác động phụ trong thành phần lớp (#phương-thức-vòng-đời:-tác-động-phụ-trong-thành-phần-lớp)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Phương thức vòng đời: tác động phụ trong thành phần lớp</span>\n\t\t\t\t</h2><p>Thành phần lớp cũng có thể định nghĩa các tác động phụ, bằng cách triển khai bất kỳ <a href=\"/guide/v10/components#lifecycle-methods\">phương thức vòng đời</a> nào mà Preact cung cấp. Dưới đây là một số phương thức vòng đời thường dùng nhất:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Phương thức vòng đời</th>\n<th align=\"left\">Khi nào nó chạy:</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>componentWillMount</code></td>\n<td align=\"left\">ngay trước khi một component được render lần đầu</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentDidMount</code></td>\n<td align=\"left\">sau khi một component được render lần đầu</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentWillReceiveProps</code></td>\n<td align=\"left\">trước khi một component được render lại</td>\n</tr>\n<tr>\n<td align=\"left\"><code>componentDidUpdate</code></td>\n<td align=\"left\">sau khi một component được render lại</td>\n</tr>\n</tbody></table>\n<p>Một trong những ví dụ phổ biến nhất về việc sử dụng tác động phụ trong thành phần lớp là lấy dữ liệu khi một component được render lần đầu, sau đó lưu dữ liệu đó vào state. Ví dụ sau đây cho thấy một component yêu cầu thông tin người dùng từ một API JSON sau lần render đầu tiên, rồi hiển thị thông tin đó.</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// hàm này được gọi sau khi component được render lần đầu:</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// lấy thông tin user JSON, lưu vào `state.user`:</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/user'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// nếu chưa nhận được dữ liệu, hiển thị thông báo đang tải:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Đang tải...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">// đã có dữ liệu! hiển thị tên người dùng lấy về từ API:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Xin chào, </span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">}</span><span class=\"token plain-text\">!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<h2 id=\"thực-hành\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#thực-hành\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Thực hành! (#thực-hành)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Thực hành!</span>\n\t\t\t\t</h2><p>Chúng ta sẽ giữ bài tập này đơn giản: hãy thay đổi đoạn mã mẫu bên phải để log ra mỗi khi <code>count</code> thay đổi, thay vì chỉ khi <code>&lt;App&gt;</code> được render lần đầu.</p>\n<solution>\n  <h4>🎉 Chúc mừng!</h4>\n  <p>Bạn đã học cách sử dụng tác động phụ trong Preact.</p>\n</solution>\n\n\n\n\n\n\n\n"}