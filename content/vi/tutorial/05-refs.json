{"meta":{"title":"Tham chiếu (Refs)","prev":"/tutorial/04-state","next":"/tutorial/06-context","solvable":true,"tutorial":{"setup":"function patch(input) {\n  if (input.__patched) return;\n  input.__patched = true;\n  var old = input.focus;\n  input.focus = function() {\n    solutionCtx.setSolved(true);\n    return old.call(this);\n  };\n}\n\nuseResult(function (result) {\n  var expectedInput;\n  var timer;\n  [].forEach.call(result.output.querySelectorAll('input'), patch);\n\n  var options = require('preact').options;\n\n  var oe = options.event;\n  options.event = function(e) {\n    if (e.currentTarget.localName !== 'button') return;\n    clearTimeout(timer);\n    var input = e.currentTarget.parentNode.parentNode.querySelector('input');\n    expectedInput = input;\n    if (input) patch(input);\n    timer = setTimeout(function() {\n      if (expectedInput === input) {\n        expectedInput = null;\n      }\n    }, 10);\n    if (oe) return oe.apply(this, arguments);\n  }\n\n  return function () {\n    options.event = oe;\n  };\n}, []);","initial":"import { render } from 'preact';\nimport { useRef } from 'preact/hooks';\n\nfunction App() {\n  function onClick() {\n\n  }\n\n  return (\n    <div>\n      <input defaultValue=\"Hello World!\" />\n      <button onClick={onClick}>Focus input</button>\n    </div>\n  );\n}\n\nrender(<App />, document.getElementById(\"app\"));","final":"import { render } from 'preact';\nimport { useRef } from 'preact/hooks';\n\nfunction App() {\n  const input = useRef();\n\n  function onClick() {\n    input.current.focus();\n  }\n\n  return (\n    <div>\n      <input ref={input} defaultValue=\"Hello World!\" />\n      <button onClick={onClick}>Focus input</button>\n    </div>\n  );\n}\n\nrender(<App />, document.getElementById(\"app\"));"}},"html":"<h1>Tham chiếu (Refs)</h1><p>Như chúng ta đã học ở chương đầu tiên, DOM cung cấp một API kiểu mệnh lệnh, cho phép chúng ta thay đổi bằng cách gọi các hàm trên các phần tử. Một ví dụ mà chúng ta có thể cần truy cập API DOM kiểu mệnh lệnh từ một component Preact là tự động chuyển focus vào một trường nhập liệu.</p>\n<p>Prop <code>autoFocus</code> (hoặc thuộc tính <code>autofocus</code>) có thể được dùng để focus vào một input ngay lần đầu nó được render, tuy nhiên có những tình huống chúng ta muốn chuyển focus vào input tại một thời điểm cụ thể, hoặc khi có một sự kiện cụ thể xảy ra.</p>\n<p>Trong các trường hợp cần tương tác trực tiếp với phần tử DOM, chúng ta có thể sử dụng một tính năng gọi là &quot;ref&quot; (tham chiếu). Một ref là một đối tượng JavaScript thông thường với thuộc tính <code>current</code> trỏ đến bất kỳ giá trị nào. Đối tượng JavaScript được truyền theo tham chiếu, nghĩa là bất kỳ hàm nào có quyền truy cập vào đối tượng ref đều có thể lấy hoặc gán giá trị của nó thông qua thuộc tính <code>current</code>. Preact không theo dõi các thay đổi của đối tượng ref, vì vậy chúng có thể được dùng để lưu trữ thông tin trong quá trình render, và sau đó có thể được truy cập bởi bất kỳ hàm nào có quyền truy cập vào đối tượng ref đó.</p>\n<p>Chúng ta có thể xem cách sử dụng trực tiếp tính năng ref mà không cần render gì cả:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span>\n\n<span class=\"token comment\">// tạo một ref:</span>\n<span class=\"token keyword\">const</span> ref <span class=\"token operator\">=</span> <span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token string\">'giá trị ban đầu'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// { current: 'giá trị ban đầu' }</span>\n\n<span class=\"token comment\">// đọc giá trị hiện tại của ref:</span>\nref<span class=\"token punctuation\">.</span>current <span class=\"token operator\">===</span> <span class=\"token string\">'giá trị ban đầu'</span>\n\n<span class=\"token comment\">// cập nhật giá trị hiện tại của ref:</span>\nref<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token string\">'giá trị mới'</span>\n\n<span class=\"token comment\">// truyền ref đi nơi khác:</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span> <span class=\"token comment\">// { current: 'giá trị mới' }</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Điều làm cho ref hữu ích trong Preact là một đối tượng ref có thể được truyền vào một phần tử Virtual DOM trong quá trình render, và Preact sẽ gán giá trị của ref (thuộc tính <code>current</code>) thành phần tử HTML tương ứng. Khi đã được gán, chúng ta có thể sử dụng giá trị hiện tại của ref để truy cập và thay đổi phần tử HTML:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// tạo một ref:</span>\n<span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// truyền ref như một prop cho phần tử Virtual DOM:</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>input<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// truy cập phần tử DOM liên kết:</span>\ninput<span class=\"token punctuation\">.</span>current <span class=\"token comment\">// một phần tử &lt;input> HTML</span>\ninput<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// focus vào input!</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Không nên sử dụng <code>createRef()</code> ở phạm vi toàn cục, vì nhiều lần render sẽ ghi đè giá trị hiện tại của ref. Thay vào đó, tốt nhất nên lưu ref dưới dạng thuộc tính của class:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRef<span class=\"token punctuation\">,</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  input <span class=\"token operator\">=</span> <span class=\"token function\">createRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// hàm này chạy sau khi &lt;App> được render</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// truy cập phần tử DOM liên kết:</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Đối với thành phần hàm, hook <code>useRef()</code> cung cấp một cách tiện lợi để tạo ref và truy cập cùng ref đó ở các lần render tiếp theo. Ví dụ sau cũng cho thấy cách sử dụng hook <code>useEffect()</code> để gọi một hàm sau khi component được render, khi đó giá trị hiện tại của ref sẽ được gán thành phần tử input HTML:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRef<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact/hooks'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// tạo hoặc lấy lại ref của chúng ta:  (hook slot 0)</span>\n  <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// hàm callback này sẽ chạy sau khi &lt;App> được render:</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// truy cập phần tử DOM liên kết:</span>\n    input<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>input<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Hãy nhớ rằng, ref không chỉ giới hạn ở việc lưu trữ phần tử DOM. Chúng có thể được dùng để lưu thông tin giữa các lần render của một component mà không cần set state (vốn sẽ gây render lại). Chúng ta sẽ thấy một số ứng dụng của điều này ở các chương sau.</p>\n<hr>\n\n\t\t\t\t<h2 id=\"thực-hành\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#thực-hành\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Thực hành! (#thực-hành)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Thực hành!</span>\n\t\t\t\t</h2><p>Bây giờ hãy thực hành bằng cách tạo một nút, khi nhấn vào sẽ focus vào trường nhập liệu bằng cách truy cập nó thông qua ref.</p>\n<solution>\n  <h4>🎉 Chúc mừng!</h4>\n  <p><code>pro = createRef()</code> → <code>pro.current = 'bạn'</code></p>\n</solution>\n\n\n\n\n\n\n"}