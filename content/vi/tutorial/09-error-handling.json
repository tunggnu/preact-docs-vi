{"meta":{"title":"Xá»­ lÃ½ lá»—i (Error Handling)","prev":"/tutorial/08-keys","next":"/tutorial/10-links","solvable":true,"tutorial":{"setup":"useResult(function(result) {\n  var options = require('preact').options;\n\n  var oe = options.__e;\n  options.__e = function(error, s) {\n    if (/objects are not valid/gi.test(error)) {\n      throw Error('CÃ³ váº» báº¡n Ä‘ang cá»‘ render má»™t Ä‘á»‘i tÆ°á»£ng Error trá»±c tiáº¿p: hÃ£y thá»­ lÆ°u `error.message` thay vÃ¬ chÃ­nh Ä‘á»‘i tÆ°á»£ng `error`.');\n    }\n    oe.apply(this, arguments);\n    setTimeout(function() {\n      if (result.output.textContent.match(/error/i)) {\n        solutionCtx.setSolved(true);\n      }\n    }, 10);\n  };\n\n  return function () {\n    options.__e = oe;\n  };\n}, []);","initial":"import { render, Component } from 'preact';\nimport { useState } from 'preact/hooks';\n\nfunction Clicker() {\n  const [clicked, setClicked] = useState(false);\n\n  if (clicked) {\n    throw new Error('TÃ´i Ä‘ang gÃ¢y lá»—i');\n  }\n\n  return <button onClick={() => setClicked(true)}>Nháº¥n tÃ´i</button>;\n}\n\nclass App extends Component {\n  state = { error: null };\n\n  render() {\n    return <Clicker />;\n  }\n}\n\nrender(<App />, document.getElementById(\"app\"));","final":"import { render, Component } from 'preact';\nimport { useState } from 'preact/hooks';\n\nfunction Clicker() {\n  const [clicked, setClicked] = useState(false);\n\n  if (clicked) {\n    throw new Error('TÃ´i Ä‘ang gÃ¢y lá»—i');\n  }\n\n  return <button onClick={() => setClicked(true)}>Nháº¥n tÃ´i</button>;\n}\n\nclass App extends Component {\n  state = { error: null };\n\n  componentDidCatch(error) {\n    this.setState({ error: error.message });\n  }\n\n  render() {\n    const { error } = this.state;\n    if (error) {\n      return <p>Ã”i khÃ´ng! ÄÃ£ cÃ³ lá»—i: {error}</p>\n    }\n    return <Clicker />;\n  }\n}\n\nrender(<App />, document.getElementById(\"app\"));"}},"html":"<h1>Xá»­ lÃ½ lá»—i (Error Handling)</h1><p>JavaScript lÃ  má»™t ngÃ´n ngá»¯ linh hoáº¡t vÃ  Ä‘Æ°á»£c thÃ´ng dá»‹ch, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  ráº¥t dá»… (tháº­m chÃ­ lÃ  thÆ°á»ng xuyÃªn) gáº·p pháº£i lá»—i khi cháº¡y chÆ°Æ¡ng trÃ¬nh. DÃ¹ lÃ  do má»™t tÃ¬nh huá»‘ng báº¥t ngá» hay do lá»—i trong mÃ£ mÃ  chÃºng ta viáº¿t, viá»‡c cÃ³ thá»ƒ theo dÃµi lá»—i vÃ  triá»ƒn khai má»™t sá»‘ hÃ¬nh thá»©c phá»¥c há»“i hoáº·c xá»­ lÃ½ lá»—i há»£p lÃ½ lÃ  ráº¥t quan trá»ng.</p>\n<p>Trong Preact, cÃ¡ch chÃºng ta lÃ m Ä‘iá»u nÃ y lÃ  báº¯t lá»—i vÃ  lÆ°u chÃºng vÃ o state. Äiá»u nÃ y cho phÃ©p má»™t component cháº·n má»™t láº§n render bá»‹ lá»—i hoáº·c khÃ´ng mong muá»‘n vÃ  chuyá»ƒn sang render má»™t ná»™i dung khÃ¡c nhÆ° má»™t phÆ°Æ¡ng Ã¡n dá»± phÃ²ng.</p>\n\n\t\t\t\t<h2 id=\"chuyá»ƒn-lá»—i-thÃ nh-state\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#chuyá»ƒn-lá»—i-thÃ nh-state\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Chuyá»ƒn lá»—i thÃ nh state (#chuyá»ƒn-lá»—i-thÃ nh-state)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Chuyá»ƒn lá»—i thÃ nh state</span>\n\t\t\t\t</h2><p>CÃ³ hai API Ä‘á»ƒ báº¯t lá»—i vÃ  chuyá»ƒn chÃºng thÃ nh state:\n<code>componentDidCatch</code> vÃ  <code>getDerivedStateFromError</code>. ChÃºng khÃ¡ giá»‘ng nhau vá» chá»©c nÄƒng, vÃ  Ä‘á»u lÃ  cÃ¡c phÆ°Æ¡ng thá»©c báº¡n cÃ³ thá»ƒ triá»ƒn khai trÃªn má»™t component lá»›p:</p>\n<p><strong>componentDidCatch</strong> nháº­n má»™t Ä‘á»‘i sá»‘ lÃ  <code>Error</code>, vÃ  cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh lÃ m gÃ¬ vá»›i lá»—i Ä‘Ã³ tÃ¹y tá»«ng trÆ°á»ng há»£p. NÃ³ cÃ³ thá»ƒ gá»i <code>this.setState()</code> Ä‘á»ƒ render má»™t cÃ¢y dá»± phÃ²ng hoáº·c thay tháº¿, Ä‘iá»u nÃ y sáº½ &quot;báº¯t&quot; lá»—i vÃ  Ä‘Ã¡nh dáº¥u nÃ³ Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½. Hoáº·c, phÆ°Æ¡ng thá»©c nÃ y cÅ©ng cÃ³ thá»ƒ chá»‰ log lá»—i á»Ÿ Ä‘Ã¢u Ä‘Ã³ vÃ  Ä‘á»ƒ nÃ³ tiáº¿p tá»¥c khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ (dáº«n Ä‘áº¿n crash).</p>\n<p><strong>getDerivedStateFromError</strong> lÃ  má»™t phÆ°Æ¡ng thá»©c tÄ©nh nháº­n vÃ o má»™t <code>Error</code>, vÃ  tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng cáº­p nháº­t state, Ä‘á»‘i tÆ°á»£ng nÃ y sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng cho component thÃ´ng qua <code>setState()</code>. VÃ¬ phÆ°Æ¡ng thá»©c nÃ y luÃ´n táº¡o ra má»™t thay Ä‘á»•i state dáº«n Ä‘áº¿n viá»‡c component Ä‘Æ°á»£c render láº¡i, nÃªn nÃ³ luÃ´n Ä‘Ã¡nh dáº¥u lá»—i lÃ  Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½.</p>\n<p>VÃ­ dá»¥ sau Ä‘Ã¢y cho tháº¥y cÃ¡ch sá»­ dá»¥ng má»™t trong hai phÆ°Æ¡ng thá»©c Ä‘á»ƒ báº¯t lá»—i vÃ  hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o lá»—i thÃ¢n thiá»‡n thay vÃ¬ bá»‹ crash:</p>\n\n\t\t\t\t<div class=\"highlight-container\">\n\t\t\t\t\t<pre class=\"highlight\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'preact'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ErrorBoundary</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token function\">getDerivedStateFromError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> error<span class=\"token punctuation\">.</span>message <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentDidCatch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">error</span><span class=\"token operator\">:</span> error<span class=\"token punctuation\">.</span>message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Ã”i khÃ´ng! ÄÃ£ gáº·p lá»—i: </span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t<p>Component trÃªn lÃ  má»™t vÃ­ dá»¥ khÃ¡ phá»• biáº¿n vá» cÃ¡ch xá»­ lÃ½ lá»—i Ä‘Æ°á»£c triá»ƒn khai trong cÃ¡c á»©ng dá»¥ng Preact, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <em>Error Boundary</em> (biÃªn lá»—i).</p>\n\n\t\t\t\t<h2 id=\"lá»“ng-nhau-vÃ -lan-truyá»n-lá»—i\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#lá»“ng-nhau-vÃ -lan-truyá»n-lá»—i\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Lá»“ng nhau vÃ  lan truyá»n lá»—i (#lá»“ng-nhau-vÃ -lan-truyá»n-lá»—i)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Lá»“ng nhau vÃ  lan truyá»n lá»—i</span>\n\t\t\t\t</h2><p>CÃ¡c lá»—i gáº·p pháº£i khi Preact render cÃ¢y Virtual DOM cá»§a báº¡n sáº½ &quot;lan truyá»n lÃªn trÃªn&quot;, giá»‘ng nhÆ° cÃ¡c sá»± kiá»‡n DOM. Báº¯t Ä‘áº§u tá»« component gáº·p lá»—i, má»—i component cha trong cÃ¢y sáº½ cÃ³ cÆ¡ há»™i xá»­ lÃ½ lá»—i Ä‘Ã³.</p>\n<p>Do Ä‘Ã³, cÃ¡c Error Boundary cÃ³ thá»ƒ Ä‘Æ°á»£c lá»“ng nhau náº¿u Ä‘Æ°á»£c triá»ƒn khai báº±ng <code>componentDidCatch</code>. Khi phÆ°Æ¡ng thá»©c <code>componentDidCatch()</code> cá»§a má»™t component <em>khÃ´ng</em> gá»i <code>setState()</code>, lá»—i sáº½ tiáº¿p tá»¥c lan lÃªn cÃ¢y Virtual DOM cho Ä‘áº¿n khi gáº·p má»™t component cÃ³ phÆ°Æ¡ng thá»©c <code>componentDidCatch</code> <em>cÃ³</em> gá»i <code>setState()</code>.</p>\n\n\t\t\t\t<h2 id=\"thá»±c-hÃ nh\">\n\t\t\t\t\t<a class=\"fragment-link\" href=\"#thá»±c-hÃ nh\">\n\t\t\t\t\t\t<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" aria-label=\"Link to: Thá»±c hÃ nh! (#thá»±c-hÃ nh)\">\n\t\t\t\t\t\t\t<use href=\"/icons.svg#link\" ></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t\t<span>Thá»±c hÃ nh!</span>\n\t\t\t\t</h2><p>Äá»ƒ kiá»ƒm tra kiáº¿n thá»©c xá»­ lÃ½ lá»—i, hÃ£y thÃªm xá»­ lÃ½ lá»—i cho má»™t component App Ä‘Æ¡n giáº£n. Má»™t trong cÃ¡c component náº±m sÃ¢u bÃªn trong App cÃ³ thá»ƒ nÃ©m ra lá»—i trong má»™t sá»‘ trÆ°á»ng há»£p, vÃ  chÃºng ta muá»‘n báº¯t lá»—i nÃ y Ä‘á»ƒ cÃ³ thá»ƒ hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o thÃ¢n thiá»‡n cho ngÆ°á»i dÃ¹ng biáº¿t ráº±ng Ä‘Ã£ gáº·p lá»—i khÃ´ng mong muá»‘n.</p>\n<solution>\n  <h4>ğŸ‰ ChÃºc má»«ng!</h4>\n  <p>Báº¡n Ä‘Ã£ há»c cÃ¡ch xá»­ lÃ½ lá»—i trong mÃ£ Preact!</p>\n</solution>\n\n\n\n\n\n\n"}