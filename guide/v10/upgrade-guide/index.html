<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<link rel="icon" href="/favicon.ico">
		<title>Upgrading from Preact 8.x â€“ Preact Guide</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui">
		<meta name="color-scheme" content="dark light">
		<meta name="theme-color" content="#673AB8">
		<link rel="alternate" type="application/rss+xml" href="https://preactjs.com/feed.xml">
		<link rel="alternate" type="application/atom+xml" href="https://preactjs.com/feed.atom">
		<meta property="og:image" content="https://preactjs.com/app-icon.png">
		<meta name="twitter:card" content="summary">
		<link href="https://esm.sh" rel="preconnect" crossorigin="anonymous">
		<link href="https://www.google-analytics.com" rel="preconnect" crossorigin="anonymous">
		<script type="module" crossorigin src="/assets/index-CLtuOrgi.js"></script>
		<link rel="stylesheet" crossorigin href="/assets/index-BQWfkFBE.css">
	<meta name="description" content="Upgrade your Preact 8.x application to Preact X">
<meta property="og:url" content="https://preactjs.com/guide/v10/upgrade-guide">
<meta property="og:title" content="Upgrading from Preact 8.x â€“ Preact Guide">
<meta property="og:description" content="Upgrade your Preact 8.x application to Preact X"></head>
	<body class="banner">
		<div id="app"><header class="_header_1a7q2_36 "><div class="_banner_1a7q2_1"><a href="https://www.stopputin.net/">We stand with Ukraine. <b>Show your support</b> ðŸ‡ºðŸ‡¦</a></div><div class="_outer_1a7q2_22"><div class="_inner_1a7q2_308"><nav><a href="/" aria-label="Home" class="home "><svg aria-label="Preact Logo" width="34px" height="34px" viewBox="-256 -256 512 512" style="display:inline-block; margin:-.25em 0 0; vertical-align:middle;"><path d="M0,-256 221.7025033688164,-128 221.7025033688164,128 0,256 -221.7025033688164,128 -221.7025033688164,-128z" fill="white"></path><ellipse cx="0" cy="0" rx="75px" ry="196px" stroke-width="16px" stroke-dasharray="387 60" stroke-dashoffset="0" fill="none" stroke="#673ab8" transform="rotate(52)"></ellipse><ellipse cx="0" cy="0" rx="75px" ry="196px" stroke-width="16px" stroke-dasharray="387 60" stroke-dashoffset="0" fill="none" stroke="#673ab8" transform="rotate(-52)"></ellipse><circle cx="0" cy="0" r="34" fill="#673ab8"></circle></svg>Preact</a><a href="/tutorial">Tutorial</a><a href="/guide/v10/getting-started" class="_current_1a7q2_90">Guide</a><div data-route="about" data-open="false" class="_navGroup_1a7q2_76"><button aria-haspopup="true" aria-expanded="false">About</button><nav aria-label="submenu" aria-hidden="true"><a href="/about/we-are-using">Companies using Preact</a><a href="/about/libraries-addons">Libraries &amp; Add-ons</a><a href="/about/demos-examples">Demos &amp; Examples</a><a href="/about/project-goals">Project Goals</a><a href="/about/browser-support">Browser Support</a></nav></div><a href="/blog">Blog</a><a href="/repl">REPL</a></nav><div class="_search_1a7q2_468"><button type="button" aria-label="Search" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="_social_1a7q2_326"><a href="https://github.com/preactjs/preact/releases/tag/10.26.6" class="_socialItem_1a7q2_345 _release_1a7q2_384">v10.26.6</a><a aria-label="Browse the code on GitHub" href="https://github.com/preactjs/preact" target="_blank" rel="noopener noreferrer" class="_socialItem_1a7q2_345"><svg aria-hidden="true" viewBox="0 0 24 24"><use href="/icons.svg#github"></use></svg></a><a aria-label="Follow us on Twitter" href="https://twitter.com/preactjs" target="_blank" rel="noopener noreferrer" class="_socialItem_1a7q2_345"><svg aria-hidden="true" viewBox="0 0 34 27.646"><use href="/icons.svg#twitter"></use></svg></a><a aria-label="Follow us on Bluesky" href="https://bsky.app/profile/preactjs.com" target="_blank" rel="noopener noreferrer" class="_socialItem_1a7q2_345"><svg aria-hidden="true" viewBox="0 0 568 501"><use href="/icons.svg#bluesky"></use></svg></a><a aria-label="Chat with us on Slack" href="http://chat.preactjs.com/" target="_blank" rel="noopener noreferrer" class="_socialItem_1a7q2_345"><svg aria-hidden="true" viewBox="0 0 512 512"><use href="/icons.svg#slack"></use></svg></a></div><div class="_translation_1a7q2_327"><div data-open="false" class="_navGroup_1a7q2_76"><button aria-label="Select your language" aria-haspopup="true" aria-expanded="false"><svg aria-hidden="true" viewBox="0 0 24 24"><use href="/icons.svg#i18n"></use></svg></button><nav aria-label="submenu" aria-hidden="true"></nav></div></div><div class="_hamburger_1a7q2_390"><div class="_hb1_1a7q2_433"></div><div class="_hb2_1a7q2_434"></div><div class="_hb3_1a7q2_435"></div></div></div></div><a href="https://opencollective.com/preact" target="_blank" rel="noopener noreferrer" class="_corner_1vho8_1"><div class="_cornerText_1vho8_31">Help<br>Support Us</div></a></header><main><loading-bar></loading-bar><div class="_page_sqynl_1 _withSidebar_sqynl_119"><div class="_outer_sqynl_111"><div class="_sidebarWrap_sqynl_115"><div data-open="false" class="_wrapper_t9oa6_1"><button value="sidebar" class="_toggle_t9oa6_6">Guide</button><aside class="_sidebar_t9oa6_58"><div class="_sidebarInner_t9oa6_93"><label class="_root_1cgs3_1">Version: <select class="_select_1cgs3_8"><option selected value="v10">10.x (current)</option><option value="v8">8.x</option></select></label><nav class="_toc_1ttwe_1 "><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">Introduction</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/getting-started" class="_link_1ttwe_16  ">Getting Started</a><a href="/guide/v10/whats-new" class="_link_1ttwe_16  ">What's new?</a><a href="/guide/v10/upgrade-guide" class="_link_1ttwe_16 _linkActive_1ttwe_43 ">Upgrading from 8.x</a><a href="/guide/v10/tutorial" class="_link_1ttwe_16  ">Tutorial</a></div><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">Essentials</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/components" class="_link_1ttwe_16  ">Components</a><a href="/guide/v10/hooks" class="_link_1ttwe_16  ">Hooks</a><a href="/guide/v10/signals" class="_link_1ttwe_16  ">Signals</a><a href="/guide/v10/forms" class="_link_1ttwe_16  ">Forms</a><a href="/guide/v10/refs" class="_link_1ttwe_16  ">References</a><a href="/guide/v10/context" class="_link_1ttwe_16  ">Context</a></div><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">Debug &amp; Test</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/debugging" class="_link_1ttwe_16  ">Debugging Tools</a><a href="/guide/v10/preact-testing-library" class="_link_1ttwe_16  ">Preact Testing Library</a><a href="/guide/v10/unit-testing-with-enzyme" class="_link_1ttwe_16  ">Unit Testing with Enzyme</a></div><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">React compatibility</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/differences-to-react" class="_link_1ttwe_16  ">Differences to React</a><a href="/guide/v10/switching-to-preact" class="_link_1ttwe_16  ">Switching to Preact</a></div><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">Advanced</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/api-reference" class="_link_1ttwe_16  ">API Reference</a><a href="/guide/v10/web-components" class="_link_1ttwe_16  ">Web Components</a><a href="/guide/v10/server-side-rendering" class="_link_1ttwe_16  ">Server-Side Rendering</a><a href="/guide/v10/options" class="_link_1ttwe_16  ">Option Hooks</a><a href="/guide/v10/typescript" class="_link_1ttwe_16  ">TypeScript</a><a href="/guide/v10/no-build-workflows" class="_link_1ttwe_16  ">No-Build Workflows</a></div><h3 class="_category_1ttwe_50 _level-2_1ttwe_79">Libraries</h3><div class="_accordionBody_1ttwe_68"><a href="/guide/v10/preact-iso" class="_link_1ttwe_16  ">preact-iso</a></div></nav></div></aside></div></div><div class="_inner_sqynl_59"><div class="_wrapper_1gw8e_1"><a href="https://github.com/preactjs/preact-www/tree/master/content/en/guide/v10/upgrade-guide.md" target="_blank" rel="noopener noreferrer" class="_edit_1gw8e_13">Edit this Page</a></div><content-region name="/guide/v10/upgrade-guide" data-page-nav="false" can-edit><div class="markup"><h1>Upgrading from Preact 8.x</h1><p>This document is intended to guide you through upgrading an existing Preact 8.x application to Preact X and is divided in 3 main sections</p>
<p>Preact X brings many new exciting features such as <code>Fragments</code>, <code>hooks</code> and much improved compatibility with the React ecosystem. We tried to keep any breaking changes to the minimum possible, but couldn't eliminate all of them completely without compromising on our feature set.</p>
<hr>
<nav><ul><li><a href="#upgrading-dependencies">Upgrading dependencies</a><ul><li><a href="#updating-preact-related-libraries">Updating preact-related libraries</a></li><li><a href="#compat-has-moved-to-core">Compat has moved to core</a></li><li><a href="#third-party-libraries">Third party libraries</a><ul><li><a href="#preact-redux">preact-redux</a></li><li><a href="#mobx-preact">mobx-preact</a></li><li><a href="#styled-components">styled-components</a></li><li><a href="#preact-portal">preact-portal</a></li></ul></li></ul></li><li><a href="#getting-your-code-ready">Getting your code ready</a><ul><li><a href="#using-named-exports">Using named exports</a></li><li><a href="#render-always-diffs-existing-children">`render()` always diffs existing children</a></li><li><a href="#propschildren-is-not-always-an-array">`props.children` is not always an `array`</a></li><li><a href="#dont-access-thisstate-synchronously">Don't access `this.state` synchronously</a></li><li><a href="#dangerouslysetinnerhtml-will-skip-diffing-of-children">`dangerouslySetInnerHTML` will skip diffing of children</a></li></ul></li><li><a href="#notes-for-library-authors">Notes for library authors</a><ul><li><a href="#the-vnode-shape-has-changed">The `VNode` shape has changed</a></li><li><a href="#adjacent-text-nodes-are-not-joined-anymore">Adjacent text nodes are not joined anymore</a></li></ul></li></ul></nav><hr>

				<h2 id="upgrading-dependencies">
					<a href="#upgrading-dependencies" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Upgrading dependencies (#upgrading-dependencies)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Upgrading dependencies</span>
				</h2><p><em>Note: Throughout this guide we'll be using the <code>npm</code> client and the commands should be easily applicable to other package managers such as <code>yarn</code>.</em></p>
<p>Let's begin! First install Preact X:</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> preact</code></pre>
					
				</div>
			<p>Because compat has moved to core, there is no need for <code>preact-compat</code> anymore. Remove it with:</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-bash"><span class="token function">npm</span> remove preact-compat</code></pre>
					
				</div>
			
				<h3 id="updating-preact-related-libraries">
					<a href="#updating-preact-related-libraries" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Updating preact-related libraries (#updating-preact-related-libraries)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Updating preact-related libraries</span>
				</h3><p>To guarantee a stable ecosystem for our users (especially for our enterprise users) we've released major version updates to Preact X related libraries. If you're using <code>preact-render-to-string</code> you need to update it to the version that works with X.</p>
<table>
<thead>
<tr>
<th>Library</th>
<th>Preact 8.x</th>
<th>Preact X</th>
</tr>
</thead>
<tbody><tr>
<td><code>preact-render-to-string</code></td>
<td>4.x</td>
<td>5.x</td>
</tr>
<tr>
<td><code>preact-router</code></td>
<td>2.x</td>
<td>3.x</td>
</tr>
<tr>
<td><code>preact-jsx-chai</code></td>
<td>2.x</td>
<td>3.x</td>
</tr>
<tr>
<td><code>preact-markup</code></td>
<td>1.x</td>
<td>2.x</td>
</tr>
</tbody></table>

				<h3 id="compat-has-moved-to-core">
					<a href="#compat-has-moved-to-core" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Compat has moved to core (#compat-has-moved-to-core)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Compat has moved to core</span>
				</h3><p>To make third-party React libraries work with Preact we ship a <strong>compat</strong>ibility layer that can be imported via <code>preact/compat</code>. It was previously available as a separate package, but to make coordination easier we've moved it into the core repository. So you'll need to change existing import or alias declarations from <code>preact-compat</code> to <code>preact/compat</code> (note the slash).</p>
<p>Be careful not to introduce any spelling errors here. A common one seems to be to write <code>compact</code> instead of <code>compat</code>. If you're having trouble with that, think of <code>compat</code> as the <code>compatibility</code> layer for react. That's where the name is coming from.</p>

				<h3 id="third-party-libraries">
					<a href="#third-party-libraries" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Third party libraries (#third-party-libraries)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Third party libraries</span>
				</h3><p>Due to the nature of the breaking changes, some existing libraries may cease to work with X. Most of them have been updated already following our beta schedule but you may encounter one where this is not the case.</p>

				<h4 id="preact-redux">
					<a href="#preact-redux" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: preact-redux (#preact-redux)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>preact-redux</span>
				</h4><p><code>preact-redux</code> is one of such libraries that hasn't been updated yet. The good news is that <code>preact/compat</code> is much more React-compliant and works out of the box with the React bindings called <code>react-redux</code>. Switching to it will resolve the situation. Make sure that you've aliased <code>react</code> and <code>react-dom</code> to <code>preact/compat</code> in your bundler.</p>
<ol>
<li>Remove <code>preact-redux</code></li>
<li>Install <code>react-redux</code></li>
</ol>

				<h4 id="mobx-preact">
					<a href="#mobx-preact" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: mobx-preact (#mobx-preact)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>mobx-preact</span>
				</h4><p>Due to our increased compatibility with the react-ecosystem this package isn't needed anymore. Use <code>mobx-react</code> instead.</p>
<ol>
<li>Remove <code>mobx-preact</code></li>
<li>Install <code>mobx-react</code></li>
</ol>

				<h4 id="styled-components">
					<a href="#styled-components" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: styled-components (#styled-components)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>styled-components</span>
				</h4><p>Preact 8.x only worked up to <code>styled-components@3.x</code>. With Preact X this barrier is no more and we work with the latest version of <code>styled-components</code>. Make sure that you've <a href="/guide/v10/getting-started#aliasing-react-to-preact">aliased react to preact</a> correctly.</p>

				<h4 id="preact-portal">
					<a href="#preact-portal" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: preact-portal (#preact-portal)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>preact-portal</span>
				</h4><p>The <code>Portal</code> component is now part of <code>preact/compat</code>.</p>
<ol>
<li>Remove <code>preact-portal</code></li>
<li>Import <code>createPortal</code> from <code>preact/compat</code></li>
</ol>

				<h2 id="getting-your-code-ready">
					<a href="#getting-your-code-ready" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Getting your code ready (#getting-your-code-ready)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Getting your code ready</span>
				</h2>
				<h3 id="using-named-exports">
					<a href="#using-named-exports" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Using named exports (#using-named-exports)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Using named exports</span>
				</h3><p>To better support tree-shaking we don't ship with a <code>default</code> export in preact core anymore. The advantage of this approach is that only the code you need will be included in your bundle.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-js"><span class="token comment">// Preact 8.x</span>
<span class="token keyword">import</span> Preact <span class="token keyword">from</span> <span class="token string">&quot;preact&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Preact X</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> preact <span class="token keyword">from</span> <span class="token string">&quot;preact&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Preferred: Named exports (works in 8.x and Preact X)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;preact&quot;</span><span class="token punctuation">;</span></code></pre>
					
				</div>
			<p><em>Note: This change doesn't affect <code>preact/compat</code>. It still has both named and a default export to remain compatible with react.</em></p>

				<h3 id="render-always-diffs-existing-children">
					<a href="#render-always-diffs-existing-children" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: `render()` always diffs existing children (#render-always-diffs-existing-children)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>`render()` always diffs existing children</span>
				</h3><p>In Preact 8.x, the calls to <code>render()</code> would always append the elements to the container.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token comment">// Existing markup:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Preact 8.x output:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
					
				</div>
			<p>In order to diff existing children in Preact 8, an existing DOM node had to be provided.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token comment">// Existing markup:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token keyword">let</span> element<span class="token punctuation">;</span>
element <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
element <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Preact 8.x output:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
					
				</div>
			<p>In Preact X, <code>render()</code> always diffs DOM children inside of the container. So if your container contains DOM that was not rendered by Preact, Preact will try to diff it with the elements you pass it. This new behavior more closely matches the behavior of other VDOM libraries.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token comment">// Existing markup:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Preact X output:</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">bar</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
					
				</div>
			<p>If you are looking for behavior that exactly matches how React's <code>render</code> method works, use the <code>render</code> method exported by <code>preact/compat</code>.</p>

				<h3 id="propschildren-is-not-always-an-array">
					<a href="#propschildren-is-not-always-an-array" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: `props.children` is not always an `array` (#propschildren-is-not-always-an-array)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>`props.children` is not always an `array`</span>
				</h3><p>In Preact X we can't guarantee <code>props.children</code> to always be of type <code>array</code> anymore. This change was necessary to resolve parsing ambiguities in regards to <code>Fragments</code> and components that return an <code>array</code> of children. In most cases you may not even notice it. Only in places where you'll use array methods on <code>props.children</code> directly need to be wrapped with <code>toChildArray</code>. This function will always return an array.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token comment">// Preact 8.x</span>
<span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// `.length` is an array method. In Preact X when `props.children` is not an</span>
  <span class="token comment">// array, this line will throw an exception</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">I have </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> children </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Preact X</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toChildArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;preact&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">toChildArray</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">I have </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> children </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
					
				</div>
			
				<h3 id="dont-access-thisstate-synchronously">
					<a href="#dont-access-thisstate-synchronously" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Don't access `this.state` synchronously (#dont-access-thisstate-synchronously)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Don't access `this.state` synchronously</span>
				</h3><p>In Preact X the state of a component will no longer be mutated synchronously. This means that reading from <code>this.state</code> right after a <code>setState</code> call will return the previous values. Instead you should use a callback function to modify state that depends on the previous values.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Preact 8.x</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Preact X</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prevState</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Alternatively return `null` here to abort the state update</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
					
				</div>
			
				<h3 id="dangerouslysetinnerhtml-will-skip-diffing-of-children">
					<a href="#dangerouslysetinnerhtml-will-skip-diffing-of-children" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: `dangerouslySetInnerHTML` will skip diffing of children (#dangerouslysetinnerhtml-will-skip-diffing-of-children)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>`dangerouslySetInnerHTML` will skip diffing of children</span>
				</h3><p>When a <code>vnode</code> has the property <code>dangerouslySetInnerHTML</code> set Preact will skip diffing the <code>vnode's</code> children.</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">I will be skipped</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">So will I</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
					
				</div>
			
				<h2 id="notes-for-library-authors">
					<a href="#notes-for-library-authors" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Notes for library authors (#notes-for-library-authors)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Notes for library authors</span>
				</h2><p>This section is intended for library authors who are maintaining packages to be used with Preact X. You can safely skip this section if you're not writing one.</p>

				<h3 id="the-vnode-shape-has-changed">
					<a href="#the-vnode-shape-has-changed" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: The `VNode` shape has changed (#the-vnode-shape-has-changed)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>The `VNode` shape has changed</span>
				</h3><p>We renamed/moved the following properties:</p>
<ul>
<li><code>attributes</code> -> <code>props</code></li>
<li><code>nodeName</code> -> <code>type</code></li>
<li><code>children</code> -> <code>props.children</code></li>
</ul>
<p>As much as we tried, we always ran into edge-cases with third-party libraries written for react. This change to our <code>vnode</code> shape removed many difficult to spot bugs and makes our <code>compat</code> code a lot cleaner.</p>

				<h3 id="adjacent-text-nodes-are-not-joined-anymore">
					<a href="#adjacent-text-nodes-are-not-joined-anymore" class="fragment-link">
						<svg width="16" height="16" viewBox="0 0 24 24" aria-label="Link to: Adjacent text nodes are not joined anymore (#adjacent-text-nodes-are-not-joined-anymore)">
							<use href="/icons.svg#link"></use>
						</svg>
					</a>
					<span>Adjacent text nodes are not joined anymore</span>
				</h3><p>In Preact 8.x we had this feature where we would join adjacent text notes as an optimization. This doesn't hold true for X anymore because we're not diffing directly against the dom anymore. In fact we noticed that it hurt performance in X which is why we removed it. Take the following example:</p>

				<div class="highlight-container">
					<pre class="highlight"><code class="language-jsx"><span class="token comment">// Preact 8.x</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token punctuation">{</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Logs a structure like this:</span>
<span class="token comment">//   div</span>
<span class="token comment">//     text</span>

<span class="token comment">// Preact X</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">foo</span><span class="token punctuation">{</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Logs a structure like this:</span>
<span class="token comment">//   div</span>
<span class="token comment">//     text</span>
<span class="token comment">//     text</span></code></pre>
					
				</div>
			</div></content-region><footer class="_footer_8z8ez_1"><div><p><label>Language: <select><option selected value="en">English</option><option value="vi">Tiáº¿ng Viá»‡t</option></select><code>?lang=en</code></label></p><p style="line-height: 1">Built by a bunch of <a href="https://github.com/preactjs/preact/graphs/contributors" target="_blank" rel="noopener noreferrer">lovely people</a>  like <a href="https://github.com/digitalica" target="_blank" rel="noopener noreferrer">@digitalica</a>.</p></div></footer></div></div></div></main><script type="isodata"></script><script async defer src="https://www.google-analytics.com/analytics.js"></script><script type="application/json" id="prerender-data">{"preactVersion":"10.26.6","preactReleaseURL":"https://github.com/preactjs/preact/releases/tag/10.26.6","preactStargazers":37495}</script></div>
	</body>
</html>
